--- 50-miniupnpd.orig	2009-11-03 02:00:22.000000000 +0300
+++ 50-miniupnpd	2009-11-03 03:41:33.000000000 +0300
@@ -1,5 +1,17 @@
 #!/bin/sh
 
+upnpOn()
+  {
+  local ri=0
+  upnpIface="`uci get multiwan.@upnpon[$ri].iface`"
+  while test -n "$upnpIface"
+    do
+    test "$1" == "$upnpIface" && return
+    done
+  false
+  }
+
+
 /etc/init.d/miniupnpd enabled && {
 
 	local state="${ZONE}_${INTERFACE}"
@@ -8,7 +20,7 @@
 	config_load upnpd
 	config_get extif config external_iface
 
-	if [ "$ACTION" = "add" ] && [ "$INTERFACE" = "$extif" ]; then
+	if [ "$ACTION" = "add" ] && { [ "$INTERFACE" = "$extif" ] || upnpOn "$INTERFACE" } ; then
 
 		local active
 		config_get active "$state" ifname
@@ -29,7 +41,7 @@
 			uci_set_state upnpd "$state" ipaddr "$ipaddr"
 		}
 	
-	elif [ "$ACTION" = "remove" ] && [ "$INTERFACE" = "$extif" ]; then
+	elif [ "$ACTION" = "remove" ] && { [ "$INTERFACE" = "$extif" ] || upnpOn "$INTERFACE" } ; then
 
 		local ifname ipaddr
 		config_get ifname "$state" ifname
